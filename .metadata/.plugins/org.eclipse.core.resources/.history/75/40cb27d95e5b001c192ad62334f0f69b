package application.view;

import java.util.List;

import application.Main;
import application.controller.DriversController;
import application.controller.UsersController;
import application.model.Drivers;
import application.model.Users;
import application.view.AdminPanelUsersViewController.EditingMode;
import javafx.collections.ListChangeListener;
import javafx.collections.ListChangeListener.Change;
import javafx.fxml.FXML;

import javafx.scene.control.Button;
import javafx.scene.control.PasswordField;
import javafx.scene.control.TableColumn;
import javafx.scene.control.TableView;
import javafx.scene.control.TextField;
import javafx.scene.control.ToggleButton;
import javafx.scene.control.cell.PropertyValueFactory;

public class AdminPanelDriversViewController {

	@FXML
	private TableView driversTableView;

	@FXML
	private TextField nameInputField;
	@FXML
	private TextField surnameInputField;
	@FXML
	private TextField driving_licenseInputField;
	
	private Drivers selectedDriver;
	
	@FXML
	private Button addButton;
	@FXML
	private Button editButton;
	@FXML
	private Button deleteButton;
	
	private Main main;
	
	private ListChangeListener<Drivers> selectionListener;
	
	public void onDeleteButtonClick() {

		main.getDriversController().delete(selectedDriver);
		updateTableView();
		clearDriverFields();

	}

	public void onCreateButtonCick() {

		clearDriverFields();
		enableTableView(false);
		enableEditButttons(false);
		editingMode = EditingMode.adding;
		enableInputFields(true);

	}

	public void onEditButtonCick() {

		enableTableView(false);
		enableEditButttons(false);
		editingMode = EditingMode.editing;
		enableInputFields(true);

	}

	public void setUp() {

		// dodawanie kolumny id
		TableColumn<Drivers, Integer> column1 = new TableColumn("Id");
		column1.setCellValueFactory(new PropertyValueFactory("id"));
		driversTableView.getColumns().add(column1);

		// dodawanie kolumny imie
		TableColumn<Drivers, String> column2 = new TableColumn("Imiê");
		column2.setCellValueFactory(new PropertyValueFactory("name"));
		driversTableView.getColumns().add(column2);

		// dodawanie kolumny nazwisko
		TableColumn<Drivers, String> column3 = new TableColumn("Nazwisko");
		column3.setCellValueFactory(new PropertyValueFactory("surname"));
		driversTableView.getColumns().add(column3);

		// dodawanie kolumny nr prawa jazdy 
		TableColumn<Drivers, String> column4 = new TableColumn("Nr prawa jazdy");
		column4.setCellValueFactory(new PropertyValueFactory("username"));
		driversTableView.getColumns().add(column4);

		
		DriversController controller = main.getDriversController();

		List<Drivers> AllDrivers = controller.getAllDrivers();

		for (Drivers driver : AllDrivers) {

			driversTableView.getItems().add(driver);

		}

		nameInputField.setEditable(false);
		surnameInputField.setEditable(false);
		driving_licenseInputField.setEditable(false);
		


	
	private void enableTableView(boolean enabled) {

		if (enabled) {
			driversTableView.getSelectionModel().getSelectedItems().addListener(selectionListener);
		} else {
			driversTableView.getSelectionModel().getSelectedItems().removeListener(selectionListener);
		}

	}
	
	
	
	
	
	private void enableEditButttons(boolean enabled) {

		addButton.setDisable(!enabled);
		editButton.setDisable(!enabled);
		deleteButton.setDisable(!enabled);

	}
	
	private void onSelectedDriver(Drivers driver) {

		selectedDriver = driver;
		nameInputField.setText(selectedDriver.getName());
		surnameInputField.setText(selectedDriver.getSurname());
		driving_licenseInputField.setText(selectedDriver.getDriving_license());
		

	}
	
	private void clearDriverFields() {

		nameInputField.setText(null);
		surnameInputField.setText(null);
		driving_licenseInputField.setText(null);
		

	}
	
	private void updateTableView() {

		DriversController controller = main.getDriversController();

		List<Drivers> AllDrivers = controller.getAllDrivers();

		driversTableView.getItems().clear();

		for (Drivers driver : AllDrivers) {

			driversTableView.getItems().add(driver);
		}
	}

	public void setmainapp(Main main) {

		this.main = main;

	}
	
	public enum EditingMode {
		adding, editing, none
	}

	public enum ValidatingStatus {
		sukces, pustePole, tekstZaDlugi, wartoscNieunikatowa

	}


}
